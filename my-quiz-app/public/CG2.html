<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>컴퓨터 그래픽스 문제 풀이 Part 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .code-block {
            background-color: #f4f4f5;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            overflow-x: auto;
            white-space: pre;
            border: 1px solid #e4e4e7;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .answer-box {
            display: none;
            background-color: #ecfdf5;
            border: 1px solid #10b981;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            color: #064e3b;
        }
        .answer-box.visible {
            display: block;
        }
        .chapter-title {
            border-bottom: 2px solid #8b5cf6; /* 보라색 테마로 변경하여 Part 1과 구분 */
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            color: #5b21b6;
        }
        .blank-line {
            display: inline-block;
            width: 100px;
            border-bottom: 1px solid #333;
            margin: 0 5px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans leading-relaxed">

    <div class="max-w-4xl mx-auto p-6 bg-white shadow-lg my-8 rounded-lg">
        <h1 class="text-3xl font-bold text-center mb-2 text-purple-800">컴퓨터 그래픽스 문제 풀이 Part 2</h1>
        <p class="text-center text-gray-500 mb-8">solutions-edit.pdf 추가 문제 (10, 14, 15장)</p>

        <div class="flex justify-end mb-6">
            <button onclick="toggleAllAnswers()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                정답 전체 보기/숨기기
            </button>
        </div>

        <!-- Chapter 10: Output Merger -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold chapter-title">Chapter 10: Output Merger (심화)</h2>

            <!-- Q3 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">3. 다중 레이어 알파 블렌딩</h3>
                <p class="mb-4">세 개의 삼각형이 뷰포트에 있고 모두 z축에 수직입니다. <span class="text-red-500 font-bold">빨강</span> 삼각형은 <span class="text-green-500 font-bold">초록</span> 뒤에 있고, 초록은 <span class="text-blue-500 font-bold">파랑</span> 뒤에 있습니다. (순서: 빨강 -> 초록 -> 파랑)</p>
                <p class="mb-2">세 프래그먼트가 한 픽셀 위치에서 경쟁하며, RGBA 색상은 다음과 같습니다:</p>
                <ul class="list-disc pl-6 mb-4 font-mono text-sm">
                    <li>빨강 (Red): (1, 0, 0, 1) <span class="text-gray-500">- 불투명(Alpha 1)</span></li>
                    <li>초록 (Green): (0, 1, 0, 0.5) <span class="text-gray-500">- 반투명</span></li>
                    <li>파랑 (Blue): (0, 0, 1, 0.5) <span class="text-gray-500">- 반투명</span></li>
                </ul>
                <p><strong>뒤에서 앞(Back-to-front)</strong> 순서로 처리될 때 최종 픽셀 색상을 계산하시오.</p>
                <button onclick="toggleAnswer('ans10-3')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans10-3" class="answer-box">
                    <p><strong>(0.25, 0.25, 0.5)</strong></p>
                    <div class="mt-2 text-sm bg-white p-2 rounded border border-green-200">
                        <p>1. <strong>빨강</strong> 그리기 (배경): <code>(1, 0, 0)</code></p>
                        <p>2. <strong>초록</strong> 블렌딩 (위에 덮어쓰기, \(\alpha=0.5\)):<br>
                           \( C = 0.5 \times (0,1,0) + (1-0.5) \times (1,0,0) = (0.5, 0.5, 0) \) (노란색 계열)</p>
                        <p>3. <strong>파랑</strong> 블렌딩 (그 위에 덮어쓰기, \(\alpha=0.5\)):<br>
                           \( C = 0.5 \times (0,0,1) + 0.5 \times (0.5, 0.5, 0) \)<br>
                           \( = (0, 0, 0.5) + (0.25, 0.25, 0) \)<br>
                           \( = (0.25, 0.25, 0.5) \)
                        </p>
                    </div>
                </div>
            </div>

            <!-- Q4 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">4. 깊이 정렬과 블렌딩</h3>
                <p class="mb-4">5개의 프래그먼트 \(f_1\) ~ \(f_5\)가 있습니다.</p>
                <div class="bg-gray-100 p-2 mb-4 font-mono text-sm">
                    f1 = {(1, 0, 0, 0.5), z=0.2}<br>
                    f2 = {(0, 1, 1, 0.5), z=0.4}<br>
                    f3 = {(0, 0, 1, 1.0), z=0.6} (불투명)<br>
                    f4 = {(1, 0, 1, 0.5), z=0.8}<br>
                    f5 = {(0, 1, 0, 1.0), z=1.0} (불투명)
                </div>
                <p>(a) Back-to-front (멀리 있는 것부터) 순서로 처리한다면 올바른 순서는 무엇입니까?</p>
                <p>(b) 최종 픽셀 색상을 계산하시오.</p>
                <button onclick="toggleAnswer('ans10-4')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans10-4" class="answer-box">
                    <p><strong>(a) 처리 순서:</strong> \(f_5 \rightarrow f_4 \rightarrow f_3 \rightarrow f_2 \rightarrow f_1\)</p>
                    <p class="text-sm text-gray-600 mb-2">(z값이 클수록 멀리 있습니다. \(1.0 \rightarrow 0.2\))</p>
                    <p><strong>(b) 최종 색상: (0.5, 0.25, 0.5)</strong></p>
                    <div class="text-sm mt-2 border-t pt-2">
                        <p><em>힌트: \(f_3\)가 불투명(alpha=1.0)하다는 점에 주목하세요.</em></p>
                        <p>\(f_3\)가 그려지는 순간 그 뒤에 있는 \(f_4, f_5\)의 색상은 완전히 덮여서 사라집니다. 따라서 \(f_3\)부터 계산하면 됩니다.</p>
                        <ul class="list-decimal pl-5 mt-1">
                            <li><strong>f3 (Base):</strong> (0, 0, 1)</li>
                            <li><strong>f2 (Blend):</strong> \(0.5(0,1,1) + 0.5(0,0,1) = (0, 0.5, 1)\)</li>
                            <li><strong>f1 (Blend):</strong> \(0.5(1,0,0) + 0.5(0, 0.5, 1) = (0.5, 0.25, 0.5)\)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chapter 14: Normal Mapping -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold chapter-title">Chapter 14: Normal Mapping (심화)</h2>

            <!-- Q3 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">3. 접선 공간-월드 공간 변환 행렬</h3>
                <p class="mb-4">버텍스 배열에 <strong>접선 공간(Tangent-Space) 기저 벡터 \((T, B, N)\)</strong>이 저장되어 버텍스 셰이더로 전달된다고 가정합시다. 접선 공간의 법선 벡터를 월드 공간으로 변환하는 행렬 \(M\)을 쓰시오.</p>
                <button onclick="toggleAnswer('ans14-3')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans14-3" class="answer-box">
                    <p>$$ M = \begin{pmatrix} T_x & B_x & N_x \\ T_y & B_y & N_y \\ T_z & B_z & N_z \end{pmatrix} $$</p>
                    <p class="text-sm text-gray-600">이 행렬은 접선 공간의 벡터를 월드 공간으로 회전시킵니다.</p>
                </div>
            </div>

            <!-- Q4 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">4. 높이 맵(Height Field)의 법선 계산</h3>
                <p class="mb-4">높이 맵(Height Field)의 한 점에서의 법선을 구할 때, 유한 차분법(finite difference method) 외에 <strong>인접한 삼각형들을 이용하는 다른 방법</strong>을 설명하시오.</p>
                <button onclick="toggleAnswer('ans14-4')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans14-4" class="answer-box">
                    <p>해당 점(버텍스)을 공유하는 <strong>모든 인접 삼각형들의 표면 법선(Face Normal)을 구한 뒤, 그들의 평균(mean)</strong>을 해당 점의 법선으로 사용합니다.</p>
                </div>
            </div>

            <!-- Q5 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">5. 프래그먼트 셰이더 코드 완성</h3>
                <p class="mb-4">접선 공간 노멀 매핑을 위한 프래그먼트 셰이더입니다. 빈칸에 들어갈 코드를 작성하시오.</p>
                <div class="code-block text-xs">
void main() {
    // 1. 노멀 맵에서 법선 가져오기 & 범위 변환 [0,1]->[-1,1]
    vec3 normal = _______________________________________________;

    // 2. 조명 벡터 정규화 (버텍스 셰이더에서 넘어온 값)
    vec3 light = _______________________________________________;

    vec3 matDiff = texture(colorMap, v_texCoord).rgb;
    
    // 3. 확산광(Diffuse) 계산
    vec3 diff = _______________________________________________;

    fragColor = vec4(diff, 1.0);
}
                </div>
                <button onclick="toggleAnswer('ans14-5')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans14-5" class="answer-box">
                    <ul class="list-disc pl-5 font-mono text-sm space-y-2">
                        <li><strong>normal:</strong> <code>normalize(2.0 * texture(normalMap, v_texCoord).rgb - 1.0)</code></li>
                        <li><strong>light:</strong> <code>normalize(v_lightTS)</code></li>
                        <li><strong>diff:</strong> <code>max(dot(normal, light), 0.0) * srcDiff * matDiff</code></li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Chapter 15: Shadow Mapping -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold chapter-title">Chapter 15: Shadow Mapping (심화)</h2>

            <!-- Q2 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">2. 첫 번째 패스(First-pass) 버텍스 셰이더</h3>
                <p class="mb-4">그림자 맵을 생성하는 첫 번째 패스(Pass 1)의 버텍스 셰이더입니다. <code>gl_Position</code>을 계산하는 코드를 작성하시오. (<code>lightViewMat</code>, <code>lightProjMat</code> 사용)</p>
                <div class="code-block text-xs">
uniform mat4 worldMat;
uniform mat4 lightViewMat, lightProjMat;
layout(location = 0) in vec3 position;

void main() {
    // 여기에 들어갈 코드는?
    gl_Position = _____________________________________;
}
                </div>
                <button onclick="toggleAnswer('ans15-2')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans15-2" class="answer-box">
                    <p class="font-mono">gl_Position = lightProjMat * lightViewMat * worldMat * vec4(position, 1.0);</p>
                    <p class="text-sm text-gray-600 mt-2">광원 시점에서의 투영 변환을 수행하여 깊이 값을 계산하기 위함입니다.</p>
                </div>
            </div>

            <!-- Q5 -->
            <div class="mb-8 p-4 border rounded-lg hover:shadow-md transition">
                <h3 class="text-lg font-semibold mb-2">5. 두 번째 패스 - 가시성(Visibility) 계산</h3>
                <p class="mb-4">두 번째 패스의 프래그먼트 셰이더에서 <code>sampler2DShadow</code>를 사용하여 그림자 여부를 판별합니다. 빈칸을 채우시오.</p>
                <div class="code-block text-xs">
uniform sampler2DShadow shadowMap;
in vec4 v_shadowCoord;
// ...
void main() {
    // ...
    // 그림자 맵 투영 텍스처 접근 (가시성 계산)
    // v_shadowCoord는 w로 나누기 전의 동차 좌표라고 가정
    float visibility = _____________________________________;

    fragColor = vec4(visibility * diff, 1.0);
}
                </div>
                <button onclick="toggleAnswer('ans15-5')" class="text-purple-500 hover:text-purple-700 text-sm font-semibold mt-2">정답 보기</button>
                <div id="ans15-5" class="answer-box">
                    <p class="font-mono">textureProj(shadowMap, v_shadowCoord)</p>
                    <p class="text-sm text-gray-600 mt-2"><code>textureProj</code> 함수는 텍스처 좌표를 마지막 성분(w)으로 나누는 과정을 자동으로 수행하고, 깊이 비교까지 처리하여 가시성(0.0 또는 1.0, PCF 시 중간값)을 반환합니다.</p>
                </div>
            </div>
        </section>

    </div>

    <script>
        function toggleAnswer(id) {
            const el = document.getElementById(id);
            el.classList.toggle('visible');
        }

        function toggleAllAnswers() {
            const allAnswers = document.querySelectorAll('.answer-box');
            const anyVisible = Array.from(allAnswers).some(el => el.classList.contains('visible'));
            
            allAnswers.forEach(el => {
                if (anyVisible) {
                    el.classList.remove('visible');
                } else {
                    el.classList.add('visible');
                }
            });
        }
    </script>
</body>
</html>